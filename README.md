# ğŸ§  Allen Brain AD Analysis

A complete computational pipeline for analyzing single-cell RNA-seq data from Alzheimer's Disease (AD) studies, modeled after Allen Brain Atlas datasets.

## ğŸ“‹ Overview

This repository contains analysis scripts for:
- Quality control and preprocessing of single-cell data
- UMAP visualization and clustering
- Pseudo-bulk differential expression analysis
- Pathway enrichment and functional analysis

## ğŸ“ Repository Structure

```
allen-brain-ad-analysis/
â”œâ”€â”€ README.md
â”œâ”€â”€ environment/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ env.yml
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                    # Input data files
â”‚   â”‚   â”œâ”€â”€ placeholder_README.txt
â”‚   â”‚   â””â”€â”€ mock_allen.h5ad     # Generated by notebook
â”‚   â””â”€â”€ processed/              # Processed outputs
â”œâ”€â”€ notebooks/
â”‚   â”œâ”€â”€ 00_generate_mock_allen_data.ipynb
â”‚   â”œâ”€â”€ 01_qc_and_preprocessing.ipynb
â”‚   â”œâ”€â”€ 02_umap_and_clustering.ipynb
â”‚   â”œâ”€â”€ 03_pseudobulk_DE.ipynb
â”‚   â””â”€â”€ 04_functional_analysis.ipynb
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ allen_pipeline.py       # Main analysis pipeline
â”‚   â”œâ”€â”€ run_pseudobulk_DE.R     # DESeq2 analysis
â”‚   â”œâ”€â”€ pathway_enrichment.py   # Gene set enrichment
â”‚   â”œâ”€â”€ utils.py                # Helper functions
â”‚   â””â”€â”€ config.yaml             # Configuration file
â”œâ”€â”€ results/
â”‚   â”œâ”€â”€ figures/                # Generated plots
â”‚   â”œâ”€â”€ tables/                 # Analysis results
â”‚   â””â”€â”€ logs/                   # Execution logs
â””â”€â”€ .gitignore
```

## ğŸš€ Quick Start

### Option 1: Docker (Recommended)

```bash
# Build the container
docker build -t allen-brain-ad -f environment/Dockerfile .

# Run the analysis
docker run -v $(pwd):/app allen-brain-ad
```

### Option 2: Local Installation

```bash
# Install dependencies
pip install -r environment/requirements.txt

# Generate mock dataset (first time only)
jupyter notebook notebooks/00_generate_mock_allen_data.ipynb

# Run the pipeline
python scripts/allen_pipeline.py
```

## ğŸ“Š Analysis Workflow

### 1. Generate Mock Dataset
The `00_generate_mock_allen_data.ipynb` notebook creates a synthetic single-cell dataset with:
- 2,000 cells across 1,500 genes
- Cell types: Excitatory, Inhibitory, Astrocyte, Microglia, Oligodendrocyte
- Metadata: donor ID, diagnosis (Control/AD), age, sex

### 2. Quality Control & Preprocessing
- Filter cells by gene count thresholds
- Normalize counts (10,000 counts per cell)
- Log-transform data
- Identify highly variable genes

### 3. Dimensionality Reduction
- PCA for initial dimensionality reduction
- UMAP for visualization
- Clustering analysis

### 4. Pseudo-bulk Differential Expression
Two approaches available:
- **Python**: Linear regression with statsmodels (age, sex covariates)
- **R**: DESeq2 for robust differential expression

### 5. Functional Analysis
- Pathway enrichment using g:Profiler
- Gene ontology analysis
- Results exported to CSV

## ğŸ”§ Configuration

Edit `scripts/config.yaml` to customize:

```yaml
data:
  input_path: data/raw/mock_allen.h5ad
  output_dir: results
qc:
  min_genes: 200
  max_mt_pct: 5
analysis:
  n_hvg: 1000
  covariates: [age, sex]
```

## ğŸ“¦ Dependencies

Core packages:
- `scanpy` - Single-cell analysis
- `anndata` - Annotated data structures
- `pandas` / `numpy` - Data manipulation
- `matplotlib` / `seaborn` - Visualization
- `statsmodels` - Statistical modeling
- `gprofiler-official` - Pathway enrichment

See `environment/requirements.txt` for complete list.

## ğŸ“ˆ Output Files

### Generated Tables
- `pseudobulk_counts.csv` - Aggregated expression matrix
- `pseudobulk_metadata.csv` - Sample-level metadata
- `de_results_mock.csv` - Differential expression results
- `deseq2_results.csv` - DESeq2 output (if using R)
- `pathway_enrichment.csv` - Enriched pathways

### Generated Figures
- UMAP plots colored by cell type and diagnosis
- QC metric distributions
- Volcano plots (in notebooks)

## ğŸ§ª Running Individual Components

```bash
# Python DE analysis
python scripts/allen_pipeline.py

# R-based DESeq2
Rscript scripts/run_pseudobulk_DE.R

# Pathway enrichment
python scripts/pathway_enrichment.py
```

## ğŸ“ Notes

- This repository uses **mock/synthetic data** for demonstration purposes
- Real Allen Brain Atlas data requires appropriate data use agreements
- Adjust QC thresholds and analysis parameters based on your dataset
- Docker container includes both Python and R environments

## ğŸ¤ Contributing

This is a template repository. To use with real data:
1. Replace `mock_allen.h5ad` with your actual dataset
2. Adjust QC parameters in `config.yaml`
3. Modify cell type annotations as needed
4. Update covariate models for your experimental design

## ğŸ“„ License

This project is provided as-is for educational and research purposes.

## ğŸ”— Resources

- [Scanpy Documentation](https://scanpy.readthedocs.io/)
- [Allen Brain Atlas](https://portal.brain-map.org/)
- [DESeq2 Vignette](https://bioconductor.org/packages/release/bioc/html/DESeq2.html)
- [g:Profiler](https://biit.cs.ut.ee/gprofiler/)

---

**Questions or Issues?** Open an issue or check the notebooks for detailed examples.